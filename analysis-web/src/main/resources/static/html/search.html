
<!DOCTYPE html>
<html lang="en-ZH">

<head>
    <meta charset="UTF-8">
    <title>条件查询</title>
    <script src="../js/jquery-1.12.4.js"></script>
    <script src="../js/common.js"></script>
    </script>
    <script type="text/javascript">
            $(document).ready(function(){
                $("#hint").html(localStorage.string);
                localStorage.string="";
                getList(1);
                // 查询
                $("#search").click(function(){
                    getList(1);
                });
                //重置条件
                $("#reset").click(function(){
                    getList(1);
                });
                //导入文件
                $("#import").change(function(){
                     importExcel();
                });
                $("#check").change(function(){
                    var obj=$("input[name='senId']");
                    for(var i=0;i<obj.length;i++){
                        obj[i].checked=this.checked;
                    }
                })
            })
            // 获取列表数据
            function getList(pageIndex){
                let requestData = {"senId":$("#senId").val()};
                $.ajax({
                    url:"http://localhost:8080/web/batchquery/import",
                    method:"post",
                    contentType: "application/json;charset=UTF-8",
                    data:JSON.stringify(requestData),
                    dataType:"json",
                    error:function(textStatus){
                        alert("获取数据失败"+textStatus);
                    },
                    success:function(result){
                        if(result.code = "success"){
                            alert("查询成功");
                        }
                        $("tbody").empty();
                        $("tfoot").empty();
                        $(result.message.list).each(function(i){
                                var backColor="DeepSkyBlue";
                                if(i % 2 !=0){
                                    backColor="LightSkyBlue";
                                }
                                var ctime = formatDate(result.message.list[i].createTime);
                                var v = result.message.list[i].vData;
                                if(typeof(v)== 'undefined'){
                                    v = "暂无值";
                                }
                                $("tbody").append("<tr bgcolor='"+backColor+"'>" +
                                    "<td align='center'><input type='checkbox' name='senId' value='"+result.message.list[i].senId+"'></td>"+
                                    "<td>"+result.message.list[i].senId+"</td>"+
                                    "<td>"+ctime+"</td>"+
                                    "<td>"+v+"</td>"+
                                    "<td>"+result.message.list[i].del+"</td>"+
                                    "</tr>")
                        })
                        var previous="";
                        if(result.message.hasPreviousPage){
                            previous="首页 | 上页";
                        }else{
                            var pageindex=result.message.pageSize-1;
                            previous="<a href='javascript:getList(1)'>首页</a>&nbsp;&nbsp;<a href='javascript:getList("+pageindex+")'>上页</a>";
                        }
                        var next="";
                        if(result.message.hasNextPage){
                            next="下页 | 尾页";
                        }else{
                            var pageindex=result.message.pageSize+1;
                            next="<a href='javascript:getList("+pageindex+")'>下页</a>&nbsp;&nbsp;<a href='javascript:getList("+result.message.pageNum+")'>尾页</a>";
                        }
                        $("tfoot").append("<tr><td colspan='7' align='right'>"+previous+"&nbsp;&nbsp;"+result.pageIndex+"/"+
                                result.message.total+"&nbsp;&nbsp;"+next+"</td></tr>");
                    }
                }

                )
            }
            //时间戳转换方法    date:时间戳数字
            function formatDate(date) {
              var date = new Date(date);
              var YY = date.getFullYear() + '-';
              var MM = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1) + '-';
              var DD = (date.getDate() < 10 ? '0' + (date.getDate()) : date.getDate());
              var hh = (date.getHours() < 10 ? '0' + date.getHours() : date.getHours()) + ':';
              var mm = (date.getMinutes() < 10 ? '0' + date.getMinutes() : date.getMinutes()) + ':';
              var ss = (date.getSeconds() < 10 ? '0' + date.getSeconds() : date.getSeconds());
              return YY + MM + DD +" "+hh + mm + ss;
            }
            function importExcel(file){
                //　截取上传的文件后缀
                var extension = file.substring(file.lastIndexOf("."),file.length);
                // 验证上传文件后缀是否合法
                var strRegex = "(.xls|.xlsx)$";
                var re = new RegExp(strRegex);
                // 如果不合法，在页面上显示出相应的提示消息
                if (!re.test(extension.toLowerCase())) {
                    alert('文件名不合法，请上传Excel文件！');
                  return false;
                }
                var file = $("#fileData").file();
                $.ajax({
                    url:"http://localhost:8080/web/excel/upload",
                    method:"post",
                    data:file,
                    dataType:"json",
                    contentType: "multipart/form-data",
                    success : function(result){
                        alert("导入成功");
                    }
                    }
                )
            }
    </script>
</head>

<body>
<div align="center" class='DataSearch'>
    <h1>信息查询</h1>
    <table border="1" width="100%">
        <thead>
        <tr>
            <td colspan="7" align="right">
                <!--                <label>-->
                <!--                    <span class='text' name='sen-id'>SENID：</span>-->
                <!--                    <input type="text" class="input" name="senId" id="senId">-->
                <!--                </label>-->
                <input type="text" name="senId" id="senId">
                <input type="button" value="查询" id="search">
                <input type="button" value="重置" id="reset" onclick="document.getElementById('senId').value=''">
                <input type="file" value="导入" id="import" name="fileData">
            </td>
        </tr>
        <tr style="background-color: RoyalBlue">
            <td align="center" width="2%"><input type="checkbox" id="check"></td>
            <td align="center">SENID</td>
            <td align="center">TIME</td>
            <td align="center" width="20%">V</td>
            <td align="center" width="20%">DEL</td>
        </tr>
        </thead>
        <tbody>
        <tr id="load">
            <td colspan="7">
                <div id="" align="center">
                    <img src="../img/load.gif" width="50" height="50"/>
                    正在加载数据,请稍后...
                </div>
            </td>
        </tr>
        </tbody>
        <tfoot>

        </tfoot>
    </table>
</div>
<div id="hint">信息展示...</div>
</body>

</html>
